<div class="modal-overlay" (click)="closeModal()">
  
  <div class="modal-card" (click)="$event.stopPropagation()">
    
    <header class="modal-header">
      <h2>Editar Perfil</h2>
      <button class="close-button" (click)="closeModal()">×</button>
    </header>

    <div class="modal-body">
      <form [formGroup]="editForm" (ngSubmit)="onSubmit()">
        
        <div class="form-group">
          <label for="nomeCompleto">Nome Completo</label>
          <input type="text" 
                 id="nomeCompleto"
                 formControlName="nomeCompleto"
                 class="input-field"
                 placeholder="O seu nome completo">
          
          <div *ngIf="editForm.get('nomeCompleto')?.touched && editForm.get('nomeCompleto')?.errors" class="error-message-inline">
            <span *ngIf="editForm.get('nomeCompleto')?.errors?.['required']">
              O nome completo é obrigatório.
            </span>
            <span *ngIf="editForm.get('nomeCompleto')?.errors?.['maxlength']">
              Máximo de 200 caracteres.
            </span>
          </div>
        </div>

        <div class="form-group">
          <label for="bio">Biografia</label>
          <textarea id="bio"
                    formControlName="bio"
                    class="textarea-field"
                    rows="4"
                    placeholder="Fale um pouco sobre si..."></textarea>
          
          <div *ngIf="editForm.get('bio')?.touched && editForm.get('bio')?.errors" class="error-message-inline">
            <span *ngIf="editForm.get('bio')?.errors?.['maxlength']">
              Máximo de 500 caracteres.
            </span>
          </div>
        </div>

        <hr style="border: 0; border-top: 1px solid #eee; margin: 1.5rem 0;">
        <h4 style="font-weight: 600; margin-bottom: 1.25rem;">Links Sociais</h4>

        <div class="form-group">
          <label for="UrlPortifolio">Portfólio</label>
          <input type="url" 
                 id="UrlPortifolio"
                 formControlName="UrlPortifolio"
                 class="input-field"
                 placeholder="https://seu-portfolio.com">
          <small class="form-text">Insira a URL completa (ex: Behance, ArtStation, site pessoal).</small>
        </div>

        <div class="form-group">
          <label for="linkedinHandle">LinkedIn</label>
          <div class="input-group" [class.is-invalid]="editForm.get('linkedinHandle')?.touched && editForm.get('linkedinHandle')?.errors">
            <span class="input-prefix">{{ linkedInPrefix }}</span>
            <input type="text"
                   id="linkedinHandle"
                   formControlName="linkedinHandle"
                   class="input-field prefixed"
                   placeholder="seu-perfil-aqui"
                   (paste)="handleSocialPaste($event, 'linkedinHandle')">
          </div>
          <small class="form-text">Insira seu nome de usuário ou cole o link completo.</small>
          <div *ngIf="editForm.get('linkedinHandle')?.touched && editForm.get('linkedinHandle')?.errors?.['pattern']" class="error-message-inline">
            Use apenas letras, números, - ou _
          </div>
        </div>

        <div class="form-group">
          <label for="instagramHandle">Instagram</label>
          <div class="input-group" [class.is-invalid]="editForm.get('instagramHandle')?.touched && editForm.get('instagramHandle')?.errors">
            <span class="input-prefix">{{ instagramPrefix }}</span>
            <input type="text"
                   id="instagramHandle"
                   formControlName="instagramHandle"
                   class="input-field prefixed"
                   placeholder="seu.usuario"
                   (paste)="handleSocialPaste($event, 'instagramHandle')">
          </div>
          <small class="form-text">Insira seu nome de usuário ou cole o link completo.</small>
          <div *ngIf="editForm.get('instagramHandle')?.touched && editForm.get('instagramHandle')?.errors?.['pattern']" class="error-message-inline">
            Use apenas letras, números, . ou _
          </div>
        </div>
        
        <div class="form-group" style="margin-top: 1.5rem;">
          <label for="fotoPerfil">Foto de Perfil</label>
          
          <div class="profile-pic-preview">
            <img [src]="previewUrl || userProfile.urlFotoPerfil || 'https://placehold.co/100x100/d1568e/FFFFFF?text=?'" 
                 alt="Pré-visualização da foto de perfil">
          </div>
          
          <input type="file" 
                 id="fotoPerfil" 
                 (change)="onFileSelected($event)" 
                 accept="image/*" 
                 class="file-input">
          <small class="form-text">Selecione uma nova imagem para atualizar (opcional).</small>
        </div>

        <div *ngIf="errorMessage" class="error-message general-error">
          {{ errorMessage }}
        </div>

        <footer class="modal-actions">
          <button type="button" class="btn btn-secondary" (click)="closeModal()">
            Cancelar
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="editForm.invalid || isLoading">
            <span *ngIf="!isLoading">Guardar Alterações</span>
            <span *ngIf="isLoading">A guardar...</span>
          </button>
        </footer>

      </form>
    </div>

    <div *ngIf="isLoading" class="loading-overlay">
      <div class="spinner"></div>
    </div>

  </div>
</div>